<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Species data</title>

<script src="site_libs/header-attrs-2.26/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Macroecology and global change</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Pracs: macroecological analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="a0_setup.html">0. Getting started</a>
    </li>
    <li>
      <a href="a1_SpatialData.html">1. Spatial data in R</a>
    </li>
    <li>
      <a href="a2_RichnessGradients.html">2. Species richness gradients</a>
    </li>
    <li>
      <a href="a3_RichnessRegression.html">3. Species richness regression</a>
    </li>
    <li>
      <a href="a4_RangeMaps.html">4. Species range maps</a>
    </li>
    <li>
      <a href="a5_SpeciesThreats.html">5. Species threats</a>
    </li>
    <li>
      <a href="a6_BiodivChanges.html">6. Analysing biodiversity changes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Pracs: species distribution modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="b1_SpeciesData.html">1. Species data</a>
    </li>
    <li>
      <a href="b2_EnvData.html">2. Environmental data</a>
    </li>
    <li>
      <a href="b3_SDM_intro.html">3. SDMs: simple model fitting</a>
    </li>
    <li>
      <a href="b4_SDM_eval.html">4. SDMs: assessment and prediction</a>
    </li>
    <li>
      <a href="b5_pseudoabsence.html">5. Pseudo-absence and background data</a>
    </li>
    <li>
      <a href="b6_SDM_algorithms.html">6. SDMs: algorithms</a>
    </li>
    <li>
      <a href="b7_SDM_ensembles.html">7. SDMs: ensembles</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.uni-potsdam.de/en/ibb-macroecology/index">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/ZurellLab">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Species data</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<hr />
<div class="alert alert-info">
<p><strong>RStudio project</strong></p>
<p>Open the RStudio project that we created in the first session. I
recommend to use this RStudio project for the entire module and within
the RStudio project create separate R scripts for each session.</p>
<ul>
<li>Create a new empty R script by going to the tab “File”, select “New
File” and then “R script”</li>
<li>In the new R script, type <code># Session b1: Species data</code>
and save the file in your folder “scripts” within your project folder,
e.g. as “b1_SpeciesData.R”</li>
</ul>
</div>
<p>Many different types of biodiversity data exist, e.g. from
standardised monitoring schemes, citizen science platforms, or expert
knowledge. Each comes with own challenges. Here, we will concentrate on
GBIF as publicly available source for terrestrial species occurrence
data.</p>
<p>GBIF stands for <em>Global Biodiversity Information Facility</em>.
GBIF defines itself as “an international network and research
infrastructure funded by the world’s governments and aimed at providing
anyone, anywhere, open access to data about all types of life on Earth”.
GBIF contains worldwide point records from observations as well as
museum records or other contributions. The data are thus not
standardised and often it is unclear which spatial resolution the data
represent. To understand this, let’s look at some example under <a
href="https://www.gbif.org/" class="uri">https://www.gbif.org/</a>.</p>
<div id="occurrence-data-from-gbif" class="section level1" number="1">
<h1><span class="header-section-number">1</span> Occurrence data from
GBIF</h1>
<p>We will use the package <code>rgbif</code> to search and retrieve
data from GBIF. A good tutorial to this package is offered <a
href="https://ropensci.org/tutorials/rgbif_tutorial/">here</a>. Remember
that we can install new packages with the function
<code>install.packages()</code>. Alternatively, the <code>dismo</code>
package offers the function <code>gbif()</code> to download gbif
records. Robert Hijmans, who wrote the raster and the dismo package,
also offers great tutorials on his website: <a
href="http://rspatial.org" class="uri">http://rspatial.org</a>.</p>
<pre class="r"><code>library(rgbif)

# Check out the number of occurrences found in GBIF:
occ_count()</code></pre>
<pre><code>## [1] 3017593553</code></pre>
<pre class="r"><code># number of observations:
occ_count(basisOfRecord=&#39;OBSERVATION&#39;)</code></pre>
<pre><code>## [1] 17280868</code></pre>
<pre class="r"><code># number of occurrences reported for Germany. Check https://countrycode.org/ for country codes
occ_count(country=&#39;DE&#39;)</code></pre>
<pre><code>## [1] 60284975</code></pre>
<pre class="r"><code># number of observations reported for Germany:
occ_count(country=&#39;DE&#39;,basisOfRecord=&#39;OBSERVATION&#39;)</code></pre>
<pre><code>## [1] 104521</code></pre>
<p>As example, I picked the Alpine shrew (<em>Sorex alpinus</em>) for
today, a small mammal species occurring in Central and Suuth-Eastern
European mountain ranges. Its conservation status is near threatened (<a
href="https://www.iucnredlist.org/species/29660/9514588">Link to IUCN
redlist</a>).</p>
<div class="figure">
<img src="figures/shrew.png" alt="**Figure 1. The Alpine shrew (*Sorex alpinus*). Picture by Dr. Richard Kraft, downloaded from https://kleinsaeuger.at/sorex-alpinus.html.**" width="50%" />
<p class="caption">
<strong>Figure 1. The Alpine shrew (<em>Sorex alpinus</em>). Picture by
Dr. Richard Kraft, downloaded from <a
href="https://kleinsaeuger.at/sorex-alpinus.html"
class="uri">https://kleinsaeuger.at/sorex-alpinus.html</a>.</strong>
</p>
</div>
<p>We first check whether any synonyms exist and how many records exist
for the species. Download will be slow for high numbers of records.</p>
<pre class="r"><code># Check for synonyms
name_suggest(q=&#39;Sorex alpinus&#39;, rank=&#39;species&#39;)</code></pre>
<pre><code>## Records returned [1] 
## No. unique hierarchies [0] 
## Args [q=Sorex alpinus, limit=100, rank=species, fields1=key,
##      fields2=canonicalName, fields3=rank] 
## # A tibble: 1 × 3
##       key canonicalName rank   
##     &lt;int&gt; &lt;chr&gt;         &lt;chr&gt;  
## 1 2435986 Sorex alpinus SPECIES</code></pre>
<pre class="r"><code># Check number of records - here filtered to those with coordinate information
occ_search(scientificName = &quot;Sorex alpinus&quot;, hasCoordinate=T, limit = 10)</code></pre>
<pre><code>## Records found [1540] 
## Records returned [10] 
## No. unique hierarchies [1] 
## No. media records [10] 
## No. facets [0] 
## Args [hasCoordinate=TRUE, occurrenceStatus=PRESENT, limit=10, offset=0,
##      scientificName=Sorex alpinus, fields=all] 
## # A tibble: 10 × 91
##    key        scientificName  decimalLatitude decimalLongitude issues datasetKey
##    &lt;chr&gt;      &lt;chr&gt;                     &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     
##  1 4880822152 Sorex alpinus …            47.8            13.2  &quot;&quot;     8a863029-…
##  2 4920858783 Sorex alpinus …            47.8            13.2  &quot;bri,… c1492854-…
##  3 4926239461 Sorex alpinus …            46.5             8.84 &quot;cdc,… 50c9509d-…
##  4 4851859068 Sorex alpinus …            46.4            12.2  &quot;cdc,… 50c9509d-…
##  5 4901479303 Sorex alpinus …            47.4            11.0  &quot;cdc,… 50c9509d-…
##  6 4901510667 Sorex alpinus …            47.4            10.9  &quot;cdc,… 50c9509d-…
##  7 4881209229 Sorex alpinus …            47.8            13.2  &quot;&quot;     8a863029-…
##  8 4920797996 Sorex alpinus …            47.8            13.2  &quot;bri,… c1492854-…
##  9 4875417397 Sorex alpinus …            46.6             7.78 &quot;cdc,… 50c9509d-…
## 10 4911053760 Sorex alpinus …            49.2            20.2  &quot;cdc,… 50c9509d-…
## # ℹ 85 more variables: publishingOrgKey &lt;chr&gt;, installationKey &lt;chr&gt;,
## #   hostingOrganizationKey &lt;chr&gt;, publishingCountry &lt;chr&gt;, protocol &lt;chr&gt;,
## #   lastCrawled &lt;chr&gt;, lastParsed &lt;chr&gt;, crawlId &lt;int&gt;, basisOfRecord &lt;chr&gt;,
## #   individualCount &lt;int&gt;, occurrenceStatus &lt;chr&gt;, lifeStage &lt;chr&gt;,
## #   taxonKey &lt;int&gt;, kingdomKey &lt;int&gt;, phylumKey &lt;int&gt;, classKey &lt;int&gt;,
## #   orderKey &lt;int&gt;, familyKey &lt;int&gt;, genusKey &lt;int&gt;, speciesKey &lt;int&gt;,
## #   acceptedTaxonKey &lt;int&gt;, acceptedScientificName &lt;chr&gt;, kingdom &lt;chr&gt;, …</code></pre>
<div class="alert alert-success" role="alert">
<p><strong>Test yourself</strong></p>
<p>What does the argument <code>hasCoordinate=T</code> do? Look up the
help page and explain.</p>
</div>
<p>One of the most interesting items from the outputs is the “Records
found” at the very top of the output. Please be aware that
<code>occ_search()</code> will not allow to download more than 100’000
records. If the GBIF data contain more, then you can set additional
filters (e.g. set time period with argument <code>year</code> or
geographic extent with arguments <code>decimalLatitude</code> and
<code>decimalLongitude</code>) or split the area into spatial tiles (by
setting geographic extent) and download the tiles separately.</p>
<p>GBIF data also contain a lot of extra information about observer,
basis of record etc. Take a look at the arguments you can set in
<code>?occ_search</code> to get an overview. For example, we can limit
the data to those observations that were done by humans:</p>
<pre class="r"><code>occ_search(scientificName = &quot;Sorex alpinus&quot;, hasCoordinate=T, basisOfRecord=&#39;HUMAN_OBSERVATION&#39;, limit = 10)</code></pre>
<pre><code>## Records found [733] 
## Records returned [10] 
## No. unique hierarchies [1] 
## No. media records [10] 
## No. facets [0] 
## Args [hasCoordinate=TRUE, occurrenceStatus=PRESENT, limit=10, offset=0,
##      scientificName=Sorex alpinus, basisOfRecord=HUMAN_OBSERVATION, fields=all] 
## # A tibble: 10 × 91
##    key        scientificName  decimalLatitude decimalLongitude issues datasetKey
##    &lt;chr&gt;      &lt;chr&gt;                     &lt;dbl&gt;            &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     
##  1 4880822152 Sorex alpinus …            47.8            13.2  &quot;&quot;     8a863029-…
##  2 4926239461 Sorex alpinus …            46.5             8.84 &quot;cdc,… 50c9509d-…
##  3 4851859068 Sorex alpinus …            46.4            12.2  &quot;cdc,… 50c9509d-…
##  4 4901479303 Sorex alpinus …            47.4            11.0  &quot;cdc,… 50c9509d-…
##  5 4901510667 Sorex alpinus …            47.4            10.9  &quot;cdc,… 50c9509d-…
##  6 4881209229 Sorex alpinus …            47.8            13.2  &quot;&quot;     8a863029-…
##  7 4875417397 Sorex alpinus …            46.6             7.78 &quot;cdc,… 50c9509d-…
##  8 4911053760 Sorex alpinus …            49.2            20.2  &quot;cdc,… 50c9509d-…
##  9 4901019930 Sorex alpinus …            49.2            19.0  &quot;cdc,… 50c9509d-…
## 10 4903977845 Sorex alpinus …            46.3            11.7  &quot;cdc,… 50c9509d-…
## # ℹ 85 more variables: publishingOrgKey &lt;chr&gt;, installationKey &lt;chr&gt;,
## #   hostingOrganizationKey &lt;chr&gt;, publishingCountry &lt;chr&gt;, protocol &lt;chr&gt;,
## #   lastCrawled &lt;chr&gt;, lastParsed &lt;chr&gt;, crawlId &lt;int&gt;, basisOfRecord &lt;chr&gt;,
## #   individualCount &lt;int&gt;, occurrenceStatus &lt;chr&gt;, lifeStage &lt;chr&gt;,
## #   taxonKey &lt;int&gt;, kingdomKey &lt;int&gt;, phylumKey &lt;int&gt;, classKey &lt;int&gt;,
## #   orderKey &lt;int&gt;, familyKey &lt;int&gt;, genusKey &lt;int&gt;, speciesKey &lt;int&gt;,
## #   acceptedTaxonKey &lt;int&gt;, acceptedScientificName &lt;chr&gt;, kingdom &lt;chr&gt;, …</code></pre>
<p>Now, let’s download the records and plot them. We had a bit less than
600 records for the shrew, and use this as <code>limit</code>. Of
course, the map will only help us judging the data quality if we have a
rough idea where the species should occur. So, look up the species on
the web first!</p>
<pre class="r"><code>gbif_shrew &lt;- occ_search(scientificName = &quot;Sorex alpinus&quot;, hasCoordinate=T, basisOfRecord=&#39;HUMAN_OBSERVATION&#39;, limit = 600) 

# We are just interested in the data frame containing the records
gbif_shrew &lt;- gbif_shrew$data

library(maps)
maps::map(&#39;world&#39;,xlim=c(5,30), ylim=c(40,55))
points(gbif_shrew$decimalLongitude, gbif_shrew$decimalLatitude, col=&#39;red&#39;,  pch=19)</code></pre>
<p><img src="b1_SpeciesData_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
</div>
<div id="cleaning-and-cross-checking-occurrence-data"
class="section level1" number="2">
<h1><span class="header-section-number">2</span> Cleaning and
cross-checking occurrence data</h1>
<p>You should always critically assess the quality of your data. This
also holds true for GBIF data. Look at the map again, do all records
look plausible?</p>
<p>Not all coordinates seem to be correct, and we thus need to
cross-check these. Robert Hijmans provides some code in his
<code>dismo</code> <a href="http://rspatial.org">tutorials</a>. We will
here use the new package <code>CoordinateCleaner</code> (<span
class="citation">Zizka et al. (2019)</span>; see tutorials <a
href="https://ropensci.github.io/CoordinateCleaner/">here</a>). The
function <code>clean_coordinates()</code> allows cleaning geographic
coordinates using different cross-checks. Here, we first compare whether
the coordinates for each entry match the country code provided (test
<code>centroids</code>) for each entry and are no outliers (test
<code>outliers</code>). Also, we test for vicinity to a biodiversity
institution like botanical or zoological gardens (test
<code>ìnstitutions</code> and radius <code>inst_rad</code>), and for
duplicates (test <code>duplicates</code>). There are many more tests
that you can check in the help pages
<code>?clean_coordinates</code>.</p>
<pre class="r"><code>library(CoordinateCleaner)</code></pre>
<pre class="r"><code># We use only those data entries with coordinate information - Note that you don&#39;t need this if you have used the hasCoordinate=T in the occ_search() function:
gbif_shrew &lt;- subset(gbif_shrew, !is.na(decimalLatitude))

# We now clean the coordinates and check for outliers - see ?clean_coordinates for more options
gbif_shrew_cleaned_coord &lt;- clean_coordinates(gbif_shrew, lon=&quot;decimalLongitude&quot;, lat=&quot;decimalLatitude&quot;, countries=&quot;countryCode&quot;, tests=c(&quot;centroids&quot;, &quot;outliers&quot;, &quot;duplicates&quot;, &quot;institutions&quot;), inst_rad = 1000)</code></pre>
<pre><code>## Testing coordinate validity</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing country centroids</code></pre>
<pre><code>## Flagged 1 records.</code></pre>
<pre><code>## Testing geographic outliers</code></pre>
<pre><code>## Flagged 3 records.</code></pre>
<pre><code>## Testing biodiversity institutions</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing duplicates</code></pre>
<pre><code>## Flagged 135 records.</code></pre>
<pre><code>## Flagged 139 of 600 records, EQ = 0.23.</code></pre>
<pre class="r"><code># Plot world map
maps::map(&#39;world&#39;,xlim=c(5,30), ylim=c(40,55))
# Plot all gbif points downloaded
points(gbif_shrew$decimalLongitude, gbif_shrew$decimalLatitude, col=&#39;red&#39;,  pch=19)
# Plot all remaining points after cleaning
points(gbif_shrew$decimalLongitude[gbif_shrew_cleaned_coord$.summary], gbif_shrew$decimalLatitude[gbif_shrew_cleaned_coord$.summary], col=&#39;blue&#39;,  pch=18)</code></pre>
<p><img src="b1_SpeciesData_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<pre class="r"><code># Store the cleaned point locations in a new object
gbif_shrew_cleaned &lt;- gbif_shrew[gbif_shrew_cleaned_coord$.summary,]</code></pre>
<div class="alert alert-success" role="alert">
<p><strong>Test yourself</strong></p>
<p>Look up the options in <code>clean_coordinates()</code> and think
about why I chose the specific tests and options.</p>
</div>
<p>Have a look at <span class="citation">Zizka et al. (2019)</span> and
the examples by Robert Hijmans (<a
href="https://rspatial.org/terra/sdm/2_sdm_occdata.html#species-occurrence-data">http://rspatial.org</a>
for finding out about other typical problems with GBIF and how to deal
with these.</p>
<p>Finally, save your data, for example by writing the final data frame
to file or by saving the R object(s).</p>
<pre class="r"><code>save(gbif_shrew_cleaned,file=&#39;data/gbif_shrew_cleaned.RData&#39;)</code></pre>
</div>
<div id="homework-prep" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Homework prep</h1>
<p>As homework, solve the exercises in the blue box below.</p>
<div class="alert alert-info">
<p><em><strong>Exercise:</strong></em></p>
<p>Pick a species of your choice, look it up on the web (www.gbif.org),
and then download and clean the GBIF data using
<code>occ_search()</code> and <code>clean_coordinates()</code>.</p>
<ul>
<li>Be careful with very large data sets as download will take long.
Try, for example, the Iberian lynx, the Gorilla, the Caucasian
Salamander, or any other species with max. 500-1000 records.</li>
<li>Summarise the data: how many occurrence records are there in total,
how many with coordinates, how many human observations, which time span
do the records cover?</li>
<li>Map the data</li>
<li>Clean the data: how many geographic outliers did you find, how many
duplicates?</li>
</ul>
</div>
</div>
<div id="extra-occurrence-data-for-marine-species-obis"
class="section level1" number="4">
<h1><span class="header-section-number">4</span> [<em>EXTRA</em>]
Occurrence data for marine species: OBIS</h1>
<p>Although we will concentrate on terrestrial species in the
practicals, I would at least like to mention that marine data are
available from OBIS, the the Ocean Biodiversity Information System.
Currently, the OBIS database holds more than 135 000 marine species. We
can access the database using the package <code>robis</code>. This can
be installed from github.</p>
<pre class="r"><code>library(devtools)
install_github(&quot;iobis/robis&quot;)</code></pre>
<p>You can visually check out the data on the <a
href="https://mapper.obis.org/">OBIS Mapper webpage</a>. Occurrence can
be downloaded from the website or using the function
<code>occurrence()</code> from <code>robis</code> package.</p>
<pre class="r"><code>library(robis)

# Download OBIS data for the sea otter
otter &lt;- occurrence(&#39;Enhydra lutris&#39;)

# Map data
maps::map(&#39;world&#39;)
points(otter$decimalLongitude, otter$decimalLatitude, col=&#39;blue&#39;,  pch=18)</code></pre>
<p><img src="b1_SpeciesData_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Showing the occurrence records in our typically Atlantic-centred
world view is a little confusing. We can obtain a Pacific-centred view
by simply wrapping the maps.</p>
<pre class="r"><code>maps::map(&quot;world&quot;, wrap=c(0,360))
points(ifelse(otter$decimalLongitude&lt;0,otter$decimalLongitude+360,otter$decimalLongitude), otter$decimalLatitude, col=&#39;blue&#39;,  pch=18)</code></pre>
<p><img src="b1_SpeciesData_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Overall, the data look quite plausible. In general, however, we also
need to pay attention to data cleaning in OBIS data. As the OBIS data
follow the same data standards as GBIF data, we can also use the package
<code>CoordinateCleaner</code> for data cleaning.</p>
<pre class="r"><code># We test for spatial outliers and remove duplicates
otter_cleaned_coord &lt;- clean_coordinates(otter, lon=&quot;decimalLongitude&quot;, lat=&quot;decimalLatitude&quot;, tests=c(&quot;duplicates&quot;,&quot;outliers&quot;))</code></pre>
<pre><code>## Testing coordinate validity</code></pre>
<pre><code>## Flagged 0 records.</code></pre>
<pre><code>## Testing geographic outliers</code></pre>
<pre><code>## Flagged 1352 records.</code></pre>
<pre><code>## Testing duplicates</code></pre>
<pre><code>## Flagged 3825 records.</code></pre>
<pre><code>## Flagged 4282 of 5745 records, EQ = 0.75.</code></pre>
<pre class="r"><code># remove the flagged records
otter_cleaned &lt;- otter[otter_cleaned_coord$.summary,]</code></pre>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Zizka2019" class="csl-entry">
Zizka, A., D. Silvestro, T. Andermann, J. Azevedo, C. Duarte Ritter, D.
Edler, H. Farooq, et al. 2019. <span>“<span>CoordinateCleaner</span> :
Standardized Cleaning of Occurrence Records from Biological Collection
Databases.”</span> <em>Methods in Ecology and Evolution</em> 10 (5):
744–51. <a
href="https://doi.org/10.1111/2041-210x.13152">https://doi.org/10.1111/2041-210x.13152</a>.
</div>
</div>
</div>

<!DOCTYPE html>
<html>

<br>
<hr />
<div id="footer">
<p>Damaris Zurell 2022 <a href="http://creativecommons.org/licenses/by/4.0/" >(CC BY 4.0)</a>.  </p>
</div>

</html>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
