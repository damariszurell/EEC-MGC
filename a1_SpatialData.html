<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Spatial data in R</title>

<script src="site_libs/header-attrs-2.29/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<script src="site_libs/clipboard-1.7.1/clipboard.min.js"></script>
<link href="site_libs/primer-tooltips-1.4.0/build.css" rel="stylesheet" />
<link href="site_libs/klippy-0.0.0.9500/css/klippy.min.css" rel="stylesheet" />
<script src="site_libs/klippy-0.0.0.9500/js/klippy.min.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>





<style type="text/css">
/* for pandoc --citeproc since 2.11 */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Macroecology and global change</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Pracs: macroecological analyses
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="a0_setup.html">0. Getting started</a>
    </li>
    <li>
      <a href="a1_SpatialData.html">1. Spatial data in R</a>
    </li>
    <li>
      <a href="a2_RichnessGradients.html">2. Species richness gradients</a>
    </li>
    <li>
      <a href="a3_RichnessRegression.html">3. Species richness regression</a>
    </li>
    <li>
      <a href="a4_RangeMaps.html">4. Species range maps</a>
    </li>
    <li>
      <a href="a5_SpeciesThreats.html">5. Species threats</a>
    </li>
    <li>
      <a href="a6_BiodivChanges.html">6. Analysing biodiversity changes</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Pracs: species distribution modelling
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="b1_SpeciesData.html">1. Species data</a>
    </li>
    <li>
      <a href="b2_EnvData.html">2. Environmental data</a>
    </li>
    <li>
      <a href="b3_SDM_intro.html">3. SDMs: simple model fitting</a>
    </li>
    <li>
      <a href="b4_SDM_eval.html">4. SDMs: assessment and prediction</a>
    </li>
    <li>
      <a href="b5_pseudoabsence.html">5. Pseudo-absence and background data</a>
    </li>
    <li>
      <a href="b6_SDM_algorithms.html">6. SDMs: algorithms</a>
    </li>
    <li>
      <a href="b7_SDM_ensembles.html">7. SDMs: ensembles</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://www.uni-potsdam.de/en/ibb-macroecology/index">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/ZurellLab">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Spatial data in R</h1>

</div>


<script>
  addClassKlippyTo("pre.r, pre.markdown");
  addKlippy('right', 'top', 'auto', '1', 'Copy code', 'Copied!');
</script>
<hr />
<div class="alert alert-info">
<p><strong>RStudio project</strong></p>
<p>Open the RStudio project that we created in the previous session. I
recommend to use this RStudio project for the entire module and within
the RStudio project create separate R scripts for each session.</p>
<ul>
<li>Create a new empty R script by going to the tab “File”, select “New
File” and then “R script”</li>
<li>In the new R script, type
<code># Session a1: Spatial data in R</code> and save the file in your
folder “scripts” within your project folder, e.g. as
“a1_SpatialData.R”</li>
</ul>
</div>
<p>Nowadays, R offers a lot of GIS functionalities in different
packages.</p>
<p>We will use a number of such GIS packages in R. Remember that we can
install new packages with the function <code>install.packages()</code>.
Make sure also to install the dependencies.</p>
<!-- ```{r eval=F} -->
<!-- install.packages(c('sp','raster','dismo'), dep=T) -->
<!-- ``` -->
<pre class="r"><code>install.packages(c(&#39;terra&#39;), dep=T)</code></pre>
<pre class="r"><code># load required package
library(terra)</code></pre>
<div id="introduction-to-spatial-data" class="section level1"
number="1">
<h1><span class="header-section-number">1</span> Introduction to spatial
data</h1>
<p>Spatial data are typically stored as either vector data or raster
data <span class="citation">(With 2019)</span>. Discrete objects with
clear boundaries are usually represented by vector data (e.g. individual
trees, roads, countries) while continuous phenomena without clear
boundaries are usually represented by raster data (e.g. elevation,
temperature).</p>
<p><strong>Vector data</strong> can be mapped as points, lines, and
polygons:</p>
<ul>
<li><strong>Points</strong> occur at discrete locations and are
represented by a coordinate pair (x,y). Each point may carry additional
informaton, the so-called attributes, e.g. the species name of the
individual captured at the location along with date.</li>
<li><strong>Lines</strong> describe linear features and are defined by
at least two coordinate pairs (x,y), the end points of the line. A line
can also consistent of several line segments.</li>
<li><strong>Polygons</strong> describe two-dimensional features in the
landscapes and define a bounded area, enclosed by lines. Thus, a polygon
needs to consist of at least three coordinate pairs (x,y.</li>
</ul>
<p>By contrast, <strong>Raster data</strong> represent the landscape as
a regularly spaced grid and are used to represent data that vary
continuously across space such as elevation, temperature or NDVI. Raster
cells can contain numeric values (e.g. elevation) or categorical values
(e.g. land cover type). The coordinate information is stored differently
from vector data because storing the coordinates for each grid cell in
the raster would use too much storage space. To define a raster, we only
need to know the coordinates of one corner, the spatial extent and the
spatial resolution to infer the coordinates of each cell.</p>
</div>
<div id="vector-data-in-r" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Vector data in R</h1>
<!-- The package `sp` defines a set of classes to represent spatial vector data and perform spatial data analyses. In this package, the geometries of vector data are stored as `SpatialPoints`, `SpatialLines` and `SpatialPolygons`, and their attributes are stored within `SpatialPointsDataFrame`, `SpatialLinesDataFrame` and `SpatialPolgyonsDataFrame` -->
<p>The package <code>terra</code> provides a set of classes and methods
to carry out spatial data analysis with raster and vector data. For
illustration, we will start by creating a few <code>SpatVector</code>
objects.</p>
<p>For more detailed tutorials see <a href="https://rspatial.org/terra/"
class="uri">https://rspatial.org/terra/</a>.</p>
<div id="spatialpoints" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> SpatialPoints</h2>
<p>First, we generate some random points data.</p>
<pre class="r"><code># We set a seed for the random number generator, so that we all obtain the same results
set.seed(12345)

coords &lt;- cbind(
  x &lt;- rnorm(10, sd=2),
  y &lt;- rnorm(10, sd=2)
)

str(coords)</code></pre>
<pre><code>##  num [1:10, 1:2] 1.171 1.419 -0.219 -0.907 1.212 ...</code></pre>
<pre class="r"><code>plot(coords)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>We now convert the random points into a <code>SpatVector</code>
object and inspect it.</p>
<pre class="r"><code># Convert into SpatVector
sp &lt;- terra::vect(coords)

# Check out the object
class(sp)</code></pre>
<pre><code>## [1] &quot;SpatVector&quot;
## attr(,&quot;package&quot;)
## [1] &quot;terra&quot;</code></pre>
<pre class="r"><code># And the entries:
sp </code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : points 
##  dimensions  : 10, 0  (geometries, attributes)
##  extent      : -3.635912, 1.418932, -1.772715, 3.634624  (xmin, xmax, ymin, ymax)
##  coord. ref. :</code></pre>
<pre class="r"><code>geom(sp)</code></pre>
<pre><code>##       geom part          x          y hole
##  [1,]    1    1  1.1710576 -0.2324956    0
##  [2,]    2    1  1.4189320  3.6346241    0
##  [3,]    3    1 -0.2186066  0.7412557    0
##  [4,]    4    1 -0.9069943  1.0404329    0
##  [5,]    5    1  1.2117749 -1.5010640    0
##  [6,]    6    1 -3.6359119  1.6337997    0
##  [7,]    7    1  1.2601971 -1.7727150    0
##  [8,]    8    1 -0.5523682 -0.6631552    0
##  [9,]    9    1 -0.5683195  2.2414253    0
## [10,]   10    1 -1.8386440  0.5974474    0</code></pre>
<p>We see that it is a vector data object with point geometries. An
extent (the bounding box) was created automatically from the provided
coordinates. The <code>coord. ref.</code> value is empty as we haven’t
provided a coordinate reference system (“CRS”) yet. We can explicitly
add a CRS when creating the <code>SpatVector</code> object:</p>
<pre class="r"><code>sp &lt;- terra::vect(coords, crs = &#39;+proj=longlat +datum=WGS84&#39;)
sp</code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : points 
##  dimensions  : 10, 0  (geometries, attributes)
##  extent      : -3.635912, 1.418932, -1.772715, 3.634624  (xmin, xmax, ymin, ymax)
##  coord. ref. : +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>At the moment the <code>SpatVector</code> object only contains the
point coordinates without any additional thematic information (or
attributes) for each point. Let’s assume the spatial points are trees,
either of three species. We can simply add these attributes to the
existing object. To do so, we first need to create a data frame with the
same number of rows as we have geometries (points in this case).</p>
<pre class="r"><code># Create attribute table
(data &lt;- data.frame(ID=1:10,species=sample(c(&#39;beech&#39;,&#39;oak&#39;,&#39;birch&#39;),10,replace=T)))</code></pre>
<pre><code>##    ID species
## 1   1     oak
## 2   2     oak
## 3   3   birch
## 4   4   beech
## 5   5   beech
## 6   6   birch
## 7   7     oak
## 8   8   beech
## 9   9   beech
## 10 10   birch</code></pre>
<p>Now, we combine the <code>SpatVector</code> object and the data frame
and store it in a new <code>SpatVector</code> object.</p>
<pre class="r"><code># in terra, you can simply add the additional information to the existing Spatial Vector
sp_trees &lt;- sp
terra:: values(sp_trees) &lt;- data

# Inspect the new object
sp_trees</code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : points 
##  dimensions  : 10, 2  (geometries, attributes)
##  extent      : -3.635912, 1.418932, -1.772715, 3.634624  (xmin, xmax, ymin, ymax)
##  coord. ref. : +proj=longlat +datum=WGS84 +no_defs 
##  names       :    ID species
##  type        : &lt;int&gt;   &lt;chr&gt;
##  values      :     1     oak
##                    2     oak
##                    3   birch</code></pre>
</div>
<div id="spatial-lines-and-spatial-polygons" class="section level2"
number="2.2">
<h2><span class="header-section-number">2.2</span> Spatial lines and
spatial polygons</h2>
<p>Similarly, we can also create <code>SpatVector</code> of lines or
polygons. First, we want to create a line vector object from the oaks -
we could assume that it is an oak hedgerow.</p>
<pre class="r"><code># prepare a subset of point geometries for oaks
oak   &lt;- terra::subset(sp_trees, sp_trees$species == &#39;oak&#39;)

# extract oak coordinates
oak_coords &lt;- terra::crds(oak)

# Create SpatVector lines through all oak trees in the data
oak_hedge &lt;- terra::vect(oak_coords, type=&quot;lines&quot;, crs=&#39;+proj=longlat +datum=WGS84&#39;)

# Inspect the object
oak_hedge</code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : lines 
##  dimensions  : 1, 0  (geometries, attributes)
##  extent      : 1.171058, 1.418932, -1.772715, 3.634624  (xmin, xmax, ymin, ymax)
##  coord. ref. : +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Next, we create a polygon vector from the birch data - we could
assume that it is a birch woodland patch.</p>
<pre class="r"><code># prepare a subset of point geometries for birch
birch &lt;- terra::subset( sp_trees, sp_trees$species == &#39;birch&#39;)

# extract birch coordinates
birch_coords &lt;- terra::crds(birch)

# Create SpatVector polygons 
birch_patch &lt;- terra::vect(birch_coords, type = &quot;polygons&quot;, crs=&#39;+proj=longlat +datum=WGS84&#39;)

# inspect the object
birch_patch</code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : polygons 
##  dimensions  : 1, 0  (geometries, attributes)
##  extent      : -3.635912, -0.2186066, 0.5974474, 1.6338  (xmin, xmax, ymin, ymax)
##  coord. ref. : +proj=longlat +datum=WGS84 +no_defs</code></pre>
<p>Finally, let’s plot our point, line and polygon data.</p>
<pre class="r"><code># We first plot the bird woodland patch but with the spatial extent of sp_trees (plus some buffer):
plot(birch_patch, border=&#39;blue&#39;,col=&#39;YellowGreen&#39;, ext=ext(sp_trees)*1.1, lwd=2)

# Add the oak hedge
plot(oak_hedge, col=&#39;ForestGreen&#39;, lwd=2, add=T)

# Add the trees
plot(sp_trees, cex=2, add=T)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="reading-vector-data-from-file" class="section level2"
number="2.3">
<h2><span class="header-section-number">2.3</span> Reading vector data
from file</h2>
<p>Most often, vector data are stored as shapefiles. Download the <a
href="data/IUCN_Sorex_alpinus.zip">zip folder</a> containg IUCN range
data of the Alpine Shrew to your data folder and unzip it. You will see
that several files are contained in this folder. All of these are
necessary parts of the shapefile and contain the different information
on geometry and attributes.</p>
<p>We use the <code>terra</code> package to read in the data:</p>
<pre class="r"><code>(shrew &lt;- terra::vect(&#39;data/IUCN_Sorex_alpinus.shp&#39;))</code></pre>
<pre><code>##  class       : SpatVector 
##  geometry    : polygons 
##  dimensions  : 1, 27  (geometries, attributes)
##  extent      : 5.733728, 26.67935, 42.20601, 51.89984  (xmin, xmax, ymin, ymax)
##  source      : IUCN_Sorex_alpinus.shp
##  coord. ref. : lon/lat WGS 84 (EPSG:4326) 
##  names       : id_no      binomial presence origin seasonal compiler yrcompiled
##  type        : &lt;chr&gt;         &lt;chr&gt;    &lt;int&gt;  &lt;int&gt;    &lt;int&gt;    &lt;chr&gt;      &lt;int&gt;
##  values      : 29660 Sorex alpinus        1      1        1     IUCN       2008
##         citation source dist_comm (and 17 more)
##            &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;              
##  IUCN (Internat~     NA        NA</code></pre>
<pre class="r"><code># Plot the range of the Alpine Shrew
plot(shrew, col=&#39;red&#39;)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<pre class="r"><code># Plot Central Europe as background map
library(maps)
map(&#39;world&#39;,xlim=c(5,30), ylim=c(40,55))

# Overlay the range of the Alpine Shrew
plot(shrew, col=&#39;red&#39;, add=T)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-11-2.png" width="672" /></p>
</div>
</div>
<div id="raster-data-in-r" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Raster data in R</h1>
<p>We will use the <code>terra</code> package to represent and analyse
raster data in R. The package contains raster data class
<code>SpatRaster</code>, which can contain only a single layer of raster
information or multiple layers (from separate files or from a single
multi-layer file, respectively).</p>
<p>The function <code>rast()</code> can be used to create or read in
<code>SpatRaster</code> objects.</p>
<pre class="r"><code># Create a SpatRaster object
(r1 &lt;- terra::rast(ncol = 10, nrow = 10, xmax = -80, xmin = -150, ymax = 60, ymin = 20 ))</code></pre>
<pre><code>## class       : SpatRaster 
## dimensions  : 10, 10, 1  (nrow, ncol, nlyr)
## resolution  : 7, 4  (x, y)
## extent      : -150, -80, 20, 60  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84</code></pre>
<p>We can access the attributes of each grid cell by using the function
<code>values()</code>. Obviously, there are no values yet in the
<code>RasterLayer</code> object and thus we assign some randomly.</p>
<pre class="r"><code># Inspect value in SpatRaster:
summary(terra::values(r1))</code></pre>
<pre><code>##      lyr.1    
##  Min.   : NA  
##  1st Qu.: NA  
##  Median : NA  
##  Mean   :NaN  
##  3rd Qu.: NA  
##  Max.   : NA  
##  NA&#39;s   :100</code></pre>
<pre class="r"><code># Assign values (randomly drawn from normal distribution) to the SpatRaster object:
terra::values(r1) &lt;- rnorm(ncell(r1))

# plot the raster
plot(r1)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>We can easily create a multi-layer <code>SpatRaster</code> object
using the <code>c()</code> (concatenate) function.</p>
<pre class="r"><code># Create another RasterLayer and assign values
r2 &lt;- r1
terra::values(r2) &lt;- 1:ncell(r2)

# Create multi-layer SpatRaster object
(r &lt;- c(r1, r2))</code></pre>
<pre><code>## class       : SpatRaster 
## dimensions  : 10, 10, 2  (nrow, ncol, nlyr)
## resolution  : 7, 4  (x, y)
## extent      : -150, -80, 20, 60  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 
## source(s)   : memory
## names       :     lyr.1, lyr.1 
## min values  : -2.380358,     1 
## max values  :  2.477111,   100</code></pre>
<pre class="r"><code>names(r) &lt;- c(&#39;Layer 1&#39;, &#39;Layer 2&#39;)
plot(r)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<div id="read-in-raster-data" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Read in raster
data</h2>
<p>In most cases, we will read in raster data from file. For this we can
use the same commands as above, <code>rast()</code> for reading in both
single-layer and multi-layer raster files.</p>
<p>First, download the temperature map for UK <a
href="data/UK_temp.tif">here</a> to your data folder and read it in. The
raster layer represents the mean annual in temperature [°C * 10].</p>
<pre class="r"><code># Read in SpatRaster object from file:
(temp &lt;- terra::rast(&#39;data/UK_temp.tif&#39;))</code></pre>
<pre><code>## class       : SpatRaster 
## dimensions  : 122, 66, 1  (nrow, ncol, nlyr)
## resolution  : 10000, 10000  (x, y)
## extent      : 0, 660000, 0, 1220000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs 
## source      : UK_temp.tif 
## name        :   UK_temp 
## min value   :  35.71785 
## max value   : 112.00000</code></pre>
<pre class="r"><code>plot(temp)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<p>Second, download the <a href="data/UK_bioclim.tif">geotiff file</a>
containing multi-layer raster data for 19 bioclimatic variables of UK,
and put it into your data folder. The bioclimatic variables are
explained <a
href="https://www.worldclim.org/data/bioclim.html">here</a>.</p>
<pre class="r"><code># Reading multi-layer SpatRaster data from file uses the same command as for single-layer data:
(bioclim &lt;- terra::rast(&#39;data/UK_bioclim.tif&#39;))</code></pre>
<pre><code>## class       : SpatRaster 
## dimensions  : 122, 66, 19  (nrow, ncol, nlyr)
## resolution  : 10000, 10000  (x, y)
## extent      : 0, 660000, 0, 1220000  (xmin, xmax, ymin, ymax)
## coord. ref. : +proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +units=m +no_defs 
## source      : UK_bioclim.tif 
## names       :      bio1,     bio2, bio3,     bio4,     bio5,      bio6, ... 
## min values  :  35.71785, 41.00000,   30, 3060.245, 134.0000, -55.48918, ... 
## max values  : 112.00000, 82.64219,   40, 5321.534, 231.5805,  43.00000, ...</code></pre>
<pre class="r"><code>plot(bioclim)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="download-raster-data" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Download raster
data</h2>
<p>The <code>geodata</code> package is offering direct access to some
standard repositories. Check them out in the help page
<code>?geodata</code>. The package provides access, for example, to
elevation data, data on the global administrative boundaries (gadm) as
well as current and future climates from <a
href="http://worldclim.org/">WorldClim</a> <span
class="citation">(Hijmans et al. 2005)</span>.</p>
<pre><code>## class       : SpatRaster 
## dimensions  : 1080, 2160, 19  (nrow, ncol, nlyr)
## resolution  : 0.1666667, 0.1666667  (x, y)
## extent      : -180, 180, -90, 90  (xmin, xmax, ymin, ymax)
## coord. ref. : lon/lat WGS 84 (EPSG:4326) 
## sources     : wc2.1_10m_bio_1.tif  
##               wc2.1_10m_bio_2.tif  
##               wc2.1_10m_bio_3.tif  
##               ... and 16 more source(s)
## names       : wc2.1~bio_1, wc2.1~bio_2, wc2.1~bio_3, wc2.1~bio_4, wc2.1~bio_5, wc2.1~bio_6, ... 
## min values  :   -54.72435,     1.00000,    9.131122,       0.000,   -29.68600,   -72.50025, ... 
## max values  :    30.98764,    21.14754,  100.000000,    2363.846,    48.08275,    26.30000, ...</code></pre>
<pre class="r"><code>library(geodata)

# Download global bioclimatic data from worldclim (you may have to set argument &#39;download=T&#39; for first download, if &#39;download=F&#39; it will attempt to read from file):
(clim &lt;- geodata::worldclim_global(var = &#39;bio&#39;, res = 10, download = F, path = &#39;data&#39;))</code></pre>
<pre class="r"><code>plot(clim)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="manipulate-raster-data" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Manipulate raster
data</h2>
<p>The <code>terra</code> package offers functionality to manipulate the
spatial data, for example aggregating the data to coarser resolutions
(<code>aggregate()</code>), or cropping to a specific extent
(<code>crop()</code>).</p>
<pre class="r"><code># Rough coordinates of European extent
ext_eur &lt;- c(-15,45,35,72)

# Crop the temperature layer (bio1) to roughly European extent
temp_eur &lt;- terra::crop(clim[[1]], ext_eur)

# Aggregate to one-degree and two-degree resolution (from currently 10-min resolution)
temp_eur_onedeg &lt;- terra::aggregate(temp_eur, fact=6)  
temp_eur_twodeg &lt;- terra::aggregate(temp_eur, fact=12)

# Plot the resultin maps
par(mfrow=c(1,3))
plot(temp_eur)
plot(temp_eur_onedeg)
plot(temp_eur_twodeg)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<pre class="r"><code># Test other options like the na.rm argument:
# Aggregate to one-degree and two-degree resolution (from currently 10-min resolution)
temp_eur_onedeg &lt;- terra::aggregate(temp_eur, fact=6, na.rm=T)  
temp_eur_twodeg &lt;- terra::aggregate(temp_eur, fact=12, na.rm=T)

# Plot the resultin maps
par(mfrow=c(1,3))
plot(temp_eur)
plot(temp_eur_onedeg)
plot(temp_eur_twodeg)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-20-2.png" width="672" /></p>
</div>
<div id="extract-raster-data" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Extract raster
data</h2>
<p>There are different ways for extracting information from raster
layers. We have already worked with <code>values()</code>. If we have
coordinate data, we can use these coordinates to “pierce” through raster
layers. That’s one of the easiest ways to extract relevant environmental
data for specific locations. Let’s first extract the climate data for
Potsdam.</p>
<pre class="r"><code># Potsdam coordinates - we need these as two-column matrix (or data.frame or SpatVector)
lonlat_Potsdam &lt;- matrix( c(13.063561, 52.391842), ncol=2)

# Extract temperature values for Potsdam:
terra::extract(temp_eur, lonlat_Potsdam)</code></pre>
<pre><code>##   wc2.1_10m_bio_1
## 1        9.229239</code></pre>
<pre class="r"><code># Extract climate values for Potsdam:
terra::extract(clim, lonlat_Potsdam)</code></pre>
<pre><code>##   wc2.1_10m_bio_1 wc2.1_10m_bio_2 wc2.1_10m_bio_3 wc2.1_10m_bio_4
## 1        9.229239        8.012188        30.85883        687.4697
##   wc2.1_10m_bio_5 wc2.1_10m_bio_6 wc2.1_10m_bio_7 wc2.1_10m_bio_8
## 1         23.6355         -2.3285          25.964        17.79533
##   wc2.1_10m_bio_9 wc2.1_10m_bio_10 wc2.1_10m_bio_11 wc2.1_10m_bio_12
## 1        4.618125         17.79533          0.94125              546
##   wc2.1_10m_bio_13 wc2.1_10m_bio_14 wc2.1_10m_bio_15 wc2.1_10m_bio_16
## 1               65               34         20.14255              171
##   wc2.1_10m_bio_17 wc2.1_10m_bio_18 wc2.1_10m_bio_19
## 1              111              171              127</code></pre>
<!-- For further illustration, we want to extract raster data for several locations. For this, we first create some random locations and then extract the climate data from our raster layers. -->
<!-- ```{r} -->
<!-- set.seed(8910) -->
<!-- # Generate random locations -->
<!-- lonlat <- terra::spatSample(ext(temp_eur), size = 10, lonlat=F) -->
<!-- # Map temperature and locations -->
<!-- plot(temp_eur) -->
<!-- points(lonlat, cex=2, pch=19) -->
<!-- # Extract temperature values at these locations -->
<!-- terra::extract(temp_eur, lonlat) -->
<!-- ``` -->
<p>For further illustration, we want to extract raster data for several
locations, specifically for different European capitals.</p>
<pre class="r"><code>capitals &lt;- data.frame(lon=c(2.333333, -3.683333, -0.083333, 12.583333, 10.75, 21, 23.316667, 24.1, 0), 
        lat=c(48.86666667, 40.4, 51.5, 55.66666667, 59.91666667, 52.25, 42.68333333, 56.95, 0),
        capital=c(&#39;Paris&#39;, &#39;Madrid&#39;, &#39;London&#39;, &#39;Copenhagen&#39;, &#39;Oslo&#39;, &#39;Warsaw&#39;, &#39;Sofia&#39;, &#39;Riga&#39;,&#39;Oops&#39;))


# Map temperature and locations
plot(temp_eur)
points(capitals[,1:2], cex=2, pch=19)</code></pre>
<p><img src="a1_SpatialData_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<pre class="r"><code># Extract temperature values at these locations
terra::extract(temp_eur, capitals[,1:2])</code></pre>
<pre><code>##   ID wc2.1_10m_bio_1
## 1  1       11.604875
## 2  2       14.344760
## 3  3       10.485146
## 4  4        8.415707
## 5  5        5.774378
## 6  6        8.199729
## 7  7        9.835594
## 8  8        6.548781
## 9  9              NA</code></pre>
<pre class="r"><code># Combine data frames:
(capitals_clim &lt;- cbind(capitals, terra::extract(temp_eur, capitals[,1:2])))</code></pre>
<pre><code>##         lon      lat    capital ID wc2.1_10m_bio_1
## 1  2.333333 48.86667      Paris  1       11.604875
## 2 -3.683333 40.40000     Madrid  2       14.344760
## 3 -0.083333 51.50000     London  3       10.485146
## 4 12.583333 55.66667 Copenhagen  4        8.415707
## 5 10.750000 59.91667       Oslo  5        5.774378
## 6 21.000000 52.25000     Warsaw  6        8.199729
## 7 23.316667 42.68333      Sofia  7        9.835594
## 8 24.100000 56.95000       Riga  8        6.548781
## 9  0.000000  0.00000       Oops  9              NA</code></pre>
<p>Note: if no environmental data are available for a specific location,
e.g. no temperature values are available in the ocean, then these
locations will receive an <code>NA</code> value. Hence, you should
always check your resulting data for <code>NA</code>s.</p>
<pre class="r"><code># Remove NAs in resulting data frame
na.exclude(capitals_clim)</code></pre>
<pre><code>##         lon      lat    capital ID wc2.1_10m_bio_1
## 1  2.333333 48.86667      Paris  1       11.604875
## 2 -3.683333 40.40000     Madrid  2       14.344760
## 3 -0.083333 51.50000     London  3       10.485146
## 4 12.583333 55.66667 Copenhagen  4        8.415707
## 5 10.750000 59.91667       Oslo  5        5.774378
## 6 21.000000 52.25000     Warsaw  6        8.199729
## 7 23.316667 42.68333      Sofia  7        9.835594
## 8 24.100000 56.95000       Riga  8        6.548781</code></pre>
<!-- Additional note: in the above example, you could also use `spatSample()` directly for extracting climate data at random locations: -->
<!-- ```{r} -->
<!-- terra::spatSample(temp_eur, size = 10, method = 'random', replace = F, xy = T, values = T) -->
<!-- ``` -->
</div>
</div>
<div id="homework-prep" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Homework prep</h1>
<p>For the homework, you will need several objects that you should not
forget to save.</p>
<pre class="r"><code># Write terra objects to file:
terra::writeRaster(temp_eur, &#39;data/temp_eur.tif&#39;)
terra::writeRaster(temp_eur_onedeg, &#39;data/temp_eur_onedeg.tif&#39;)
terra::writeRaster(temp_eur_twodeg, &#39;data/temp_eur_twodeg.tif&#39;)
# You will also need the SpatRaster &quot;clim&quot; but this was directly downloaded from geodata package, so is already on file

# Save other (non-terra) objects from the workspace:
save(capitals, file=&#39;data/a1_SpatialData.RData&#39;)</code></pre>
<p>As homework, solve all the exercises in the blue boxes.</p>
<div class="alert alert-info">
<p><em><strong>Exercise:</strong></em></p>
<ul>
<li>Take the capital locations and extract also the temperature values
at the aggregated scales (<code>temp_eur_onedeg</code>,
<code>temp_eur_twodeg</code>). Compare the temperature values.</li>
<li>Take the capital locations and extract all 19 bioclimatic variables
for these (from the <code>SpatRaster</code>object
<code>clim</code>)</li>
<li>Find the coordinates of 10 cities in Australia (or another continent
of your choice) and extract the climate values</li>
</ul>
</div>
<!-- <div class="alert alert-info"> -->
<!-- _**Exercise:**_ -->
<!-- - Take a look at the description of [Coordinate Reference Systems, CRS, by Robert Hijmans](https://rspatial.org/spatial-terra/6-crs.html) -->
<!-- - What are CRS? How can I extract the CRS information from a SpatRaster and SpatVector object? -->
<!-- - Which CRS is used in the `temp_eur` raster? -->
<!-- - Reproject `temp_eur` to a different CRS following instructions on above-mentioned website -->
<!-- - When is reprojection useful? -->
<!-- </div> -->
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="unnumbered">References</h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Hijmans2005" class="csl-entry">
Hijmans, R. J., S. E. Cameron, J. L. Parra, P. G. Jones, and A. Jarvis.
2005. <span>“Very High Resolution Interpolated Climate Surfaces for
Global Land Areas.”</span> <em>International Journal of Climatology</em>
25 (15): 1965–78. <a
href="https://doi.org/10.1002/joc.1276">https://doi.org/10.1002/joc.1276</a>.
</div>
<div id="ref-With2019" class="csl-entry">
With, Kimberly A. 2019. <em>Essentials of Landscape Ecology</em>. Oxford
University Press. <a
href="https://doi.org/10.1093/oso/9780198838388.001.0001">https://doi.org/10.1093/oso/9780198838388.001.0001</a>.
</div>
</div>
</div>

<!DOCTYPE html>
<html>

<br>
<hr />
<div id="footer">
<p>Damaris Zurell 2022 <a href="http://creativecommons.org/licenses/by/4.0/" >(CC BY 4.0)</a>.  </p>
</div>

</html>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
